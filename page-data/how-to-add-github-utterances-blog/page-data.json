{"componentChunkName":"component---src-templates-page-js","path":"/how-to-add-github-utterances-blog","result":{"data":{"markdownRemark":{"frontmatter":{"title":"How to add comment support on your Gatsby blog using Github utterances","date":"29 July 2020","path":"/how-to-add-github-utterances-blog","author":null,"excerpt":"Utterances is a free and opensource comments service powered by Github","tags":["blog","opensource","comments","utterances"],"coverImage":null},"id":"bb7d8a29-6dad-5f22-b683-7a3b2f7a5a0a","html":"<p>This post is about integrating comments support in your blog using a free and open source service.</p>\n<p><img src=\"https://images.unsplash.com/photo-1516414447565-b14be0adf13e\" alt=\"notepad\"></p>\n<p>Having a way to engage with your audience is probably the next step you can take if your blog is helping others in some way. Back when I had used <a href=\"https://gohugo.io/\">hugo</a> as my static site generator, I had used <a href=\"https://disqus.com/\">Disqus</a>, which is a comments service/system. But as with ordinary third party services, Disqus is notorious for putting their own ads and can get quite slow. As a fan of open source and code reuse, I knew there had to be some open source comments service out there. After a day of sifting through the interwebs, I found a solution that I think for the time being serves my purpose of engaging with my audience.</p>\n<p>What follows is a quick guide on how to integrate Github's <a href=\"https://github.com/utterance\">utterances</a> comments system into your blog. This also became an excuse for me stay updated with all the recent changes in the web dev space, as I've been mostly doing backend for the last two years.</p>\n<p>Utternaces is a lightweight comments widget built on top of Github issues. Some of its highlights are:</p>\n<ul>\n<li>Open source. üôå</li>\n<li>No tracking, no ads, always free. üì°üö´</li>\n<li>No lock-in. All data stored in GitHub issues. üîì</li>\n<li>Styled with Primer, the css toolkit that powers GitHub. üíÖ</li>\n<li>Dark theme. üåò</li>\n<li>Lightweight. Vanilla TypeScript. No font downloads, JavaScript frameworks or polyfills for evergreen browsers. üê¶üå≤</li>\n</ul>\n<hr>\n<p><strong>Target audience</strong>: You know ReactJS, and you probably know better than me and maybe can provide suggestions on how I can we improve the integration.</p>\n<p><strong>Disclaimer</strong>: This comments system only works if your target audience has a Github account, which in majority of cases are developers. As my blog is mostly oriented towards developers, this aligns perfectly with my blog.</p>\n<hr>\n<p>The official guide of <a href=\"https://utteranc.es/\">utterances</a> mentions integrating the comments widget on a vanilla HTML website. That won't work for my case as I happen to be running a site that is generated by <a href=\"https://www.gatsbyjs.org/\">GatsbyJS</a>, which I think is a really efficient static site generator not only in terms of development experience but also in terms of performance of the generated sites compared to my past experiences with static site generators such as Hugo.</p>\n<p>Gatsby uses React under the hood which meant that I needed to integrate utterances as a <a href=\"https://reactjs.org/docs/components-and-props.html\">React component</a>. </p>\n<p><em>Note</em>: I am by no means an expert on react or even a frontend expert, but the following steps\nis me just sifting through bunch of documentation pages and tying to cobble them together into\na working solution.</p>\n<p>So here's how I did it.</p>\n<h2>Installing utterances</h2>\n<p>First, I setup a Github repository (has to be a public repository) that will act\nas a placeholder for issues to be created within: <a href=\"https://github.com/creativcoder/creativcoder.dev-comments\">https://github.com/creativcoder/creativcoder.dev-comments</a>\nThis is needed if you have a website that is not running as a Github pages site. If you happen to have your website as a Github repository, you can configure the same repository for utterances.</p>\n<p>Next, we go to: <a href=\"https://github.com/apps/utterances\">https://github.com/apps/utterances</a> page. You will see an 'Install' button in green on the right. Clicking that, you will need to provide the repository where you want to install the widget. I chose my comments repository above.</p>\n<p>Post installation, you will be redirected to this <a href=\"https://utteranc.es/\">page</a>. In the 'Enabling Utterances' section, we need to place the following script in a div tag (or any container tag) where we want our comment widget to appear:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://utteranc.es/client.js<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">repo</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>[ENTER REPO HERE]<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">issue-term</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>pathname<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">theme</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>github-light<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">crossorigin</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>As you can see, the script tag above has multiple attributes that can be configured. The important ones to look at are:</p>\n<ul>\n<li><code class=\"language-text\">repo</code>: should point to the repository you installed utterances above section.</li>\n<li><code class=\"language-text\">issue-term</code>: how utterances should match the issues with posts on a website. In my case, am using the title of the posts. You can refer to 'Blog Post &#x3C;-> Issue Mapping' section in <a href=\"https://utteranc.es/\">https://utteranc.es/</a> for more details and choose as per your preference.</li>\n</ul>\n<h2>Integrating the comment widget</h2>\n<p>Now as I said above, the script needs to be put in a container tag for us to render the comments widget. That translates to having a component in react, within which we'll append this script tag programmatically whenever a blog post page is rendered. This will need to happen conditionally as not all pages are about a blog post page, such as the index page and the about page.</p>\n<p>To have a container for the widget to be created within, I first created a <code class=\"language-text\">Comment</code> react component (<a href=\"https://www.robinwieruch.de/react-function-component\">a functional component</a>) in <code class=\"language-text\">components/comment.js</code>: </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// commment.js</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>useRef<span class=\"token punctuation\">,</span> useEffect<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useStaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Comment</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>commentBox<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>commentBox<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>comments<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Comment</code></pre></div>\n<p>It's a very trivial component. The only thing of intereset here is the <code class=\"language-text\">commentBox</code> react ref. <a href=\"https://reactjs.org/docs/refs-and-the-dom.html#callback-refs\">React Refs</a> provide a way to access DOM nodes or React elements created within a component's render method. We'll see how that is used later. It's not really recommended to use refs, as they are sort of an escape hatch but since we only have one use case for it here, we should be fine.</p>\n<p>Next, I have a <code class=\"language-text\">&lt;Posts&gt;</code> component in my blog which renders each blog post. This is where I want the comment widget to appear at the end of each post. I needed a way to render the <code class=\"language-text\">Comments</code> component conditionally. To achieve that, I relied on the <code class=\"language-text\">excerpt</code> prop which is <code class=\"language-text\">true</code> if the rendered page is an index page, where only an excerpt of all blog posts are shown. In other cases it's set to <code class=\"language-text\">false</code>. We can use that to conditionally render the <code class=\"language-text\">Comments</code> component like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// components/posts.js</span>\n<span class=\"token punctuation\">{</span> excerpt<span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span></span> <span class=\"token attr-name\">commentBox</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>commentBox<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>It's the usual ternary operator. The <code class=\"language-text\">&lt;&gt;&lt;/&gt;</code> syntax are <a href=\"https://reactjs.org/docs/fragments.html\">fragments</a> in react, which is empty in the true branch as we only want to render the widget when the user in on the blog post page. We also see that the comment widget has a <code class=\"language-text\">commentBox</code> prop being passed. This is how we gain access to the <code class=\"language-text\">Comment</code> component for use within the <code class=\"language-text\">Posts</code> component. We'll use this ref to append the comment script tag.</p>\n<p>Back in my <code class=\"language-text\">Posts</code> component, I create a ref that was attached to the <code class=\"language-text\">commentBox</code> prop on <code class=\"language-text\">Comment</code> component:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// components/post.js</span>\n<span class=\"token keyword\">const</span> commentBox <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then, I use the <code class=\"language-text\">useEffect</code> hook to add the script tag to the <code class=\"language-text\">Comment</code> component via the ref:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> commentBox <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> scriptEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span>\n    scriptEl<span class=\"token punctuation\">.</span>async <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    scriptEl<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'https://utteranc.es/client.js'</span>\n    scriptEl<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'repo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'creativcoder/creativcoder.dev-comments'</span><span class=\"token punctuation\">)</span>\n    scriptEl<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'issue-term'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span>\n    scriptEl<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utterances'</span><span class=\"token punctuation\">)</span>\n    scriptEl<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'theme'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'github-light'</span><span class=\"token punctuation\">)</span>\n    scriptEl<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crossorigin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'anonymous'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commentBox <span class=\"token operator\">&amp;&amp;</span> commentBox<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      commentBox<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>scriptEl<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error adding utterances comments on: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>commentBox<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The code in <code class=\"language-text\">useEffect</code> will run everytime a <code class=\"language-text\">Post</code> component is rendered which will then append the comment widget to each blog post page. You can see that set the same script attributes are being added but with javascript. We then finally append it to the <code class=\"language-text\">commentBox</code> ref via its <code class=\"language-text\">current</code> property which is active when it is rendered.</p>\n<p>With that done, I did just did a <code class=\"language-text\">yarn deploy</code> and what you see below is our shiny new comment widget üëá.\nHope you find this post helpful. Let me know if you have any issues setting it up in the comments below.</p>\n<p>Until next time!</p>","excerpt":"This post is about integrating comments support in your blog using a free and open source service. notepad Having a way to engage with your‚Ä¶"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":"/quick-way-to-try-crates","title":"A simple script to try Rust crates locally","tags":["script","automation","productivity","rust","crates.io","crates"]},"fileAbsolutePath":"/home/creativcoder/opensource/creativcoder.dev/src/posts/quick-way-to-try-crates.md"},"previous":null}}}