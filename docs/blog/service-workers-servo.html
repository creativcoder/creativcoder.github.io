<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>creativcoder</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/ab2a2959b9ba8661.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ab2a2959b9ba8661.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f16eaa9e44b97d3f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f16eaa9e44b97d3f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9faa89de3ee6e754.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-32a43e1092778ede.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2e588ff4f55f23af.js" defer=""></script><script src="/_next/static/chunks/167-4ae4480dee839e87.js" defer=""></script><script src="/_next/static/chunks/675-f43734e7770ea31e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-c606869ed04a3d0b.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_buildManifest.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="" style="position:fixed;top:0;left:0;height:3px;background:transparent;z-index:99999999999;width:100%"><div class="" style="height:100%;background:#4CE0B3;transition:all 500ms ease;width:0%"><div style="box-shadow:0 0 10px #4CE0B3, 0 0 10px #4CE0B3;width:5%;opacity:1;position:absolute;height:100%;transition:all 500ms ease;transform:rotate(3deg) translate(0px, -4px);left:-10rem"></div></div></div><div class="flex min-h-screen w-screen overflow-hidden flex-col items-center dark:bg-[#242729] bg-slate-200 backdrop" style="opacity:0.5;background-color:#E2E8F0"><div class="max-w-2xl md:max-w-3xl lg:max-w-4xl space-y-12 w-screen sticky"><nav class="bg-[#f6f8f9] dark:bg-[#2b2e30] dark:shadow-md m-3 rounded-lg shadow-sm backdrop-filter backdrop-blur-md bg-opacity-40 sticky top-0 mt-10"><div class="mx-auto p-4"><div class="flex justify-between"><div class="cursor-pointer flex space-x-2 items-center"><div><img src="/logo_v3.svg" width="26" class="pt-0.5 invert"/></div><div class="text-lg dark:text-white hidden md:block">creativcoder</div></div><div class="flex items-center pr-2"><ul class="hidden md:flex md:space-x-4 pr-3"><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M18.404 2.998c-.757-.754-2.077-.751-2.828.005l-1.784 1.791L11.586 7H7a.998.998 0 0 0-.939.658l-4 11c-.133.365-.042.774.232 1.049l2 2a.997.997 0 0 0 1.049.232l11-4A.998.998 0 0 0 17 17v-4.586l2.207-2.207v-.001h.001L21 8.409c.378-.378.586-.881.585-1.415 0-.535-.209-1.038-.588-1.415l-2.593-2.581zm-3.111 8.295A.996.996 0 0 0 15 12v4.3l-9.249 3.363 4.671-4.671c.026.001.052.008.078.008A1.5 1.5 0 1 0 9 13.5c0 .026.007.052.008.078l-4.671 4.671L7.7 9H12c.266 0 .52-.105.707-.293L14.5 6.914 17.086 9.5l-1.793 1.793zm3.206-3.208-2.586-2.586 1.079-1.084 2.593 2.581-1.086 1.089z"></path></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="https://youtube.com/@creativcoder"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path fill-rule="nonzero" d="M19.606 6.995c-.076-.298-.292-.523-.539-.592C18.63 6.28 16.5 6 12 6s-6.628.28-7.069.403c-.244.068-.46.293-.537.592C4.285 7.419 4 9.196 4 12s.285 4.58.394 5.006c.076.297.292.522.538.59C5.372 17.72 7.5 18 12 18s6.629-.28 7.069-.403c.244-.068.46-.293.537-.592C19.715 16.581 20 14.8 20 12s-.285-4.58-.394-5.005zm1.937-.497C22 8.28 22 12 22 12s0 3.72-.457 5.502c-.254.985-.997 1.76-1.938 2.022C17.896 20 12 20 12 20s-5.893 0-7.605-.476c-.945-.266-1.687-1.04-1.938-2.022C2 15.72 2 12 2 12s0-3.72.457-5.502c.254-.985.997-1.76 1.938-2.022C6.107 4 12 4 12 4s5.896 0 7.605.476c.945.266 1.687 1.04 1.938 2.022zM10 15.5v-7l6 3.5-6 3.5z"></path></g></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/about"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 9C16 11.2091 14.2091 13 12 13C9.79086 13 8 11.2091 8 9C8 6.79086 9.79086 5 12 5C14.2091 5 16 6.79086 16 9ZM14 9C14 10.1046 13.1046 11 12 11C10.8954 11 10 10.1046 10 9C10 7.89543 10.8954 7 12 7C13.1046 7 14 7.89543 14 9Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM3 12C3 14.0902 3.71255 16.014 4.90798 17.5417C6.55245 15.3889 9.14627 14 12.0645 14C14.9448 14 17.5092 15.3531 19.1565 17.4583C20.313 15.9443 21 14.0524 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12ZM12 21C9.84977 21 7.87565 20.2459 6.32767 18.9878C7.59352 17.1812 9.69106 16 12.0645 16C14.4084 16 16.4833 17.1521 17.7538 18.9209C16.1939 20.2191 14.1881 21 12 21Z" fill="currentColor"></path></svg></a></ul><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:hidden block"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path></svg></div></div></div></nav><div><article class="dark:text-slate-200 dark:prose-headings:text-slate-200 dark:prose-code:text-slate-200 dark:prose-blockquote:text-slate-200 dark:prose-strong:text-slate-100 dark:prose-pre:bg-zinc-900 dark:prose-pre:shadow-md dark:prose-pre:border-gray-600 dark:prose-pre:border-[1.4px] dark:prose-a:text-slate-200 prose prose-xl flex flex-col mx-auto max-w-6xl justify-center pl-6 pr-6 prose-p:m-3 prose-headings:mb-3 prose-headings:mt-3 prose-a:font-bold prose-img:rounded-lg prose-img:m-auto prose-img:w-full prose-img:shadow-lg prose-code:font-jetbrains prose-pre:p-0 prose-a:no-underline prose-h1:text-4xl prose-h1:pl-2 prose-h2:pl-2 prose-blockquote:border-slate-600 prose-h2:text-xl"><div class="flex flex-col"><p class="text-4xl font-bold">Basic Service Worker support lands in Servo</p><div class="pt-3 flex justify-between flex-row-reverse"><div class="flex items-center space-x-2"><p class="text-sm">29th June 2016</p></div><div class="flex items-center space-x-2"><p class="text-sm tracking-wide">creativcoder<!-- --> / <!-- -->4min<!-- --></p></div></div><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div></div><p>The last few weeks were exciting! With amazing guidance from <!-- --><a href="https://github.com/jdm">Josh</a> and awesome people at <!-- --><a href="https://github.com/servo/servo">Servo</a> I finally have a rudimentary implementation of <!-- --><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Workers</a> (hereby mentioned as SW) in Servo capable enough to monitor network requests made from different origins and optionally send back custom responses on a registered origin with basic lifecyle events (<!-- --><code>statechange</code>, <!-- --><code>activate</code>, <!-- --><code>install</code>) supported.<!-- --></p>
<!-- --><p>Currently Service Workers are gated behind a <!-- --><code>dom.serviceworker.enabled</code> flag in Servo. To make them available in DOM&#x27;s <!-- --><code>window.navigator</code> object, Servo needs to be launched with:<!-- --></p>
<!-- --><pre><code class="hljs language-bash">./mach run --release http://example.com --pref dom.serviceworker.enabled=<!-- --><span class="hljs-literal">true</span>
<!-- --></code></pre>
<!-- --><p>An example test page specific to Servo&#x27;s implementation is available under <!-- --><a href="https://github.com/servo/servo/tree/master/tests/html/service-worker">html/service-workers</a>. This page can be used to test the current implementation.<!-- --></p>
<!-- --><p>This post will give an overview of the current implementation of SWs in Servo. Please note that the codebase is likely to change in future due to dependency over multitude of features such as the Fetch API (<!-- --><a href="https://github.com/servo/servo/issues/11894">Tracking Issue</a>) whose implementation is in progress and the Promise API (<!-- --><a href="https://github.com/servo/servo/issues/4282">Tracking Issue</a>). I also maintain a <!-- --><a href="http://github.com/creativcoder/gsoc16">repo</a> keeping track of SW implementation in Servo.<!-- --></p>
<!-- --><p>To get a basic idea of what Service Workers are, refer to my <!-- --><a href="/service-workers-web/">previous</a> blog post. Before we talk about SWs implementation, it&#x27;s helpful to mention some of the key concepts in Servo&#x27;s architecture.<!-- --></p>
<!-- --><p>I will mention only the topics that are important to SWs implementation. To get a broad overview of Servo&#x27;s architecture; refer to the <!-- --><a href="https://github.com/servo/servo/wiki/Design">Servo Wiki</a> or my <!-- --><a href="/community-bonding-gsoc-servo">blog post</a>.<!-- --></p>
<!-- --><h2 id="constellation"><a href="#constellation">Constellation</a></h2>
<!-- --><p>A Constellation in Servo is a co-ordinator of various pipelines along with other entities such as the windowing system, resource manager, caching system etc.</p>
<!-- --><h2 id="pipeline"><a href="#pipeline">Pipeline</a></h2>
<!-- --><p>A Pipeline in Servo is an abstraction of a Script Thread, Layout Thread and a Paint Thread (basically a page which gets parsed and rendered to a viewport).</p>
<!-- --><p>We&#x27;ll only focus on Script Thread here.</p>
<!-- --><p>The Script Thread is holds the DOM for a web document and is responsible for handling execution of javascript on the page.</p>
<!-- --><p>Service workers are designed so as not to depend on any context/document so they must be at a higher level in the abstraction hierarchy than the Script Thread. They can listen to network requests globally. As such, a service worker manager thread (hereby mentioned as SWM) was devised to manage service worker registrations at different origins. The idea is to have a single manager thread that can store information of all registered SW&#x27;s and can listen to network requests, activation or timeouts of any of the SW&#x27;s.</p>
<!-- --><p>The following interfaces of the Service Workers API are available in Servo (without promise integration):</p>
<!-- --><h2 id="client-context"><a href="#client-context">Client Context:</a></h2>
<!-- --><p><a href="https://github.com/servo/servo/blob/master/components/script/dom/serviceworker.rs">ServiceWorker</a></p>
<!-- --><p><a href="https://github.com/servo/servo/blob/master/components/script/dom/serviceworkercontainer.rs">ServiceWorkerContainer</a></p>
<!-- --><p><a href="https://github.com/servo/servo/blob/master/components/script/dom/serviceworkerregistration.rs">ServiceWorkerRegistration</a></p>
<!-- --><h2 id="execution-context"><a href="#execution-context">Execution Context:</a></h2>
<!-- --><p><a href="https://github.com/servo/servo/blob/master/components/script/dom/serviceworkerglobalscope.rs">ServiceWorkerGlobalScope</a></p>
<!-- --><ul>
<!-- --><li>The initialization phase:</li>
<!-- --></ul>
<!-- --><p><img src="http://i.imgur.com/rAv1za8.jpg" alt="alt init_phase"/></p>
<!-- --><p>The Constellation thread is created before any of the above mentioned threads. So it creates the required channels (here channel means creating a (<!-- --><code>Sender&lt;T&gt;</code> <!-- --><code>Receiver&lt;T&gt;</code>) pair for inter-thread communication) for SWM and passes the SWM&#x27;s sender when the constellation creates the script thread which spawns the SWM thread. We also create a channel for the resource thread to communicate with constellation. This is needed so that the resource thread can ask for any custom response from SWM mediated by constellation.<!-- --></p>
<!-- --><ul>
<!-- --><li>The registration phase:</li>
<!-- --></ul>
<!-- --><p><img src="http://i.imgur.com/lWJVImJ.jpg" alt="alt reg_phase"/></p>
<!-- --><p>Let&#x27;s take an example of a URL <!-- --><code>https://example.com</code> where we register a SW over the scope: <!-- --><code>/profile</code>. We can register a Service Worker by calling<!-- --></p>
<!-- --><pre><code class="hljs language-javascript">navigator.<!-- --><span class="hljs-property">serviceWorker</span>.<!-- --><span class="hljs-title function_">register</span>(<!-- --><span class="hljs-string">&#x27;sw.js&#x27;</span>, { <!-- --><span class="hljs-attr">scope</span>: <!-- --><span class="hljs-string">&#x27;/profile&#x27;</span> });
<!-- --></code></pre>
<!-- --><p>which returns a registration object. This registration object is then stored in the ScriptThread&#x27;s thread local storage. At this point, the worker does not start controlling pages or listening to events; instead it forwards the attributes required to spawn service to the SWM which handles the initialization of <!-- --><code>ServiceWorkerGlobalScope</code> upon url navigations.<!-- --></p>
<!-- --><ul>
<!-- --><li>The network phase:</li>
<!-- --></ul>
<!-- --><p><img src="http://i.imgur.com/xH9HrTR.jpg" alt="alt net_phase"/></p>
<!-- --><p>When the browser is navigated to the URL <!-- --><code>https://example.com/profile</code> where the SW was registered, the <!-- --><code>http_loader</code> sends a <!-- --><code>Sender</code> channel to the SWM and asks whether the currently loaded URL has a running service worker that may have a custom response. Here the SWM forwards the network&#x27;s sender to the running <!-- --><code>ServiceWorkerGlobalScope</code>&#x27;s event loop which then able to reply with any custom response that is cached in.<!-- --></p>
<!-- --><p>PS : This is still a WIP post, and there will be additions.</p><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div><p class="text-sm font-bold">Want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please follow Rust&#x27;s code of conduct. This comment thread directly maps to a discussion on GitHub, so you can also comment there if you prefer.</p></article>;<!-- --></div><footer class="flex flex-col items-center w-full"><div class="px-4 py-2 flex items-center justify-center space-x-2 border-2 rounded-md border-gray-500 hover:bg-blue-100 transition-colors hover:text-lime-900"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"></path></svg><p>Be a GitHub Sponser</p></div><div class="flex-col items-center justify-center mt-8 mb-8"><div class="text-center text-xs mx-auto">Â© 2016-<!-- -->2022<!-- --> creativcoder. All rights reserved.<!-- --></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    code: \"code\",\n    pre: \"pre\",\n    span: \"span\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    img: \"img\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"The last few weeks were exciting! With amazing guidance from \", _jsx(_components.a, {\n        href: \"https://github.com/jdm\",\n        children: \"Josh\"\n      }), \" and awesome people at \", _jsx(_components.a, {\n        href: \"https://github.com/servo/servo\",\n        children: \"Servo\"\n      }), \" I finally have a rudimentary implementation of \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\",\n        children: \"Service Workers\"\n      }), \" (hereby mentioned as SW) in Servo capable enough to monitor network requests made from different origins and optionally send back custom responses on a registered origin with basic lifecyle events (\", _jsx(_components.code, {\n        children: \"statechange\"\n      }), \", \", _jsx(_components.code, {\n        children: \"activate\"\n      }), \", \", _jsx(_components.code, {\n        children: \"install\"\n      }), \") supported.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Currently Service Workers are gated behind a \", _jsx(_components.code, {\n        children: \"dom.serviceworker.enabled\"\n      }), \" flag in Servo. To make them available in DOM's \", _jsx(_components.code, {\n        children: \"window.navigator\"\n      }), \" object, Servo needs to be launched with:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [\"./mach run --release http://example.com --pref dom.serviceworker.enabled=\", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"An example test page specific to Servo's implementation is available under \", _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/tree/master/tests/html/service-worker\",\n        children: \"html/service-workers\"\n      }), \". This page can be used to test the current implementation.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This post will give an overview of the current implementation of SWs in Servo. Please note that the codebase is likely to change in future due to dependency over multitude of features such as the Fetch API (\", _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/issues/11894\",\n        children: \"Tracking Issue\"\n      }), \") whose implementation is in progress and the Promise API (\", _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/issues/4282\",\n        children: \"Tracking Issue\"\n      }), \"). I also maintain a \", _jsx(_components.a, {\n        href: \"http://github.com/creativcoder/gsoc16\",\n        children: \"repo\"\n      }), \" keeping track of SW implementation in Servo.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To get a basic idea of what Service Workers are, refer to my \", _jsx(_components.a, {\n        href: \"/service-workers-web/\",\n        children: \"previous\"\n      }), \" blog post. Before we talk about SWs implementation, it's helpful to mention some of the key concepts in Servo's architecture.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I will mention only the topics that are important to SWs implementation. To get a broad overview of Servo's architecture; refer to the \", _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/wiki/Design\",\n        children: \"Servo Wiki\"\n      }), \" or my \", _jsx(_components.a, {\n        href: \"/community-bonding-gsoc-servo\",\n        children: \"blog post\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"constellation\",\n      children: _jsx(_components.a, {\n        href: \"#constellation\",\n        children: \"Constellation\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A Constellation in Servo is a co-ordinator of various pipelines along with other entities such as the windowing system, resource manager, caching system etc.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"pipeline\",\n      children: _jsx(_components.a, {\n        href: \"#pipeline\",\n        children: \"Pipeline\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A Pipeline in Servo is an abstraction of a Script Thread, Layout Thread and a Paint Thread (basically a page which gets parsed and rendered to a viewport).\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We'll only focus on Script Thread here.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Script Thread is holds the DOM for a web document and is responsible for handling execution of javascript on the page.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Service workers are designed so as not to depend on any context/document so they must be at a higher level in the abstraction hierarchy than the Script Thread. They can listen to network requests globally. As such, a service worker manager thread (hereby mentioned as SWM) was devised to manage service worker registrations at different origins. The idea is to have a single manager thread that can store information of all registered SW's and can listen to network requests, activation or timeouts of any of the SW's.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The following interfaces of the Service Workers API are available in Servo (without promise integration):\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"client-context\",\n      children: _jsx(_components.a, {\n        href: \"#client-context\",\n        children: \"Client Context:\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/blob/master/components/script/dom/serviceworker.rs\",\n        children: \"ServiceWorker\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/blob/master/components/script/dom/serviceworkercontainer.rs\",\n        children: \"ServiceWorkerContainer\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/blob/master/components/script/dom/serviceworkerregistration.rs\",\n        children: \"ServiceWorkerRegistration\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"execution-context\",\n      children: _jsx(_components.a, {\n        href: \"#execution-context\",\n        children: \"Execution Context:\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/servo/servo/blob/master/components/script/dom/serviceworkerglobalscope.rs\",\n        children: \"ServiceWorkerGlobalScope\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The initialization phase:\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"http://i.imgur.com/rAv1za8.jpg\",\n        alt: \"alt init_phase\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The Constellation thread is created before any of the above mentioned threads. So it creates the required channels (here channel means creating a (\", _jsx(_components.code, {\n        children: \"Sender\u003cT\u003e\"\n      }), \" \", _jsx(_components.code, {\n        children: \"Receiver\u003cT\u003e\"\n      }), \") pair for inter-thread communication) for SWM and passes the SWM's sender when the constellation creates the script thread which spawns the SWM thread. We also create a channel for the resource thread to communicate with constellation. This is needed so that the resource thread can ask for any custom response from SWM mediated by constellation.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The registration phase:\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"http://i.imgur.com/lWJVImJ.jpg\",\n        alt: \"alt reg_phase\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let's take an example of a URL \", _jsx(_components.code, {\n        children: \"https://example.com\"\n      }), \" where we register a SW over the scope: \", _jsx(_components.code, {\n        children: \"/profile\"\n      }), \". We can register a Service Worker by calling\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-javascript\",\n        children: [\"navigator.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"serviceWorker\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"register\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'sw.js'\"\n        }), \", { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"scope\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'/profile'\"\n        }), \" });\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"which returns a registration object. This registration object is then stored in the ScriptThread's thread local storage. At this point, the worker does not start controlling pages or listening to events; instead it forwards the attributes required to spawn service to the SWM which handles the initialization of \", _jsx(_components.code, {\n        children: \"ServiceWorkerGlobalScope\"\n      }), \" upon url navigations.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The network phase:\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"http://i.imgur.com/xH9HrTR.jpg\",\n        alt: \"alt net_phase\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When the browser is navigated to the URL \", _jsx(_components.code, {\n        children: \"https://example.com/profile\"\n      }), \" where the SW was registered, the \", _jsx(_components.code, {\n        children: \"http_loader\"\n      }), \" sends a \", _jsx(_components.code, {\n        children: \"Sender\"\n      }), \" channel to the SWM and asks whether the currently loaded URL has a running service worker that may have a custom response. Here the SWM forwards the network's sender to the running \", _jsx(_components.code, {\n        children: \"ServiceWorkerGlobalScope\"\n      }), \"'s event loop which then able to reply with any custom response that is cached in.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"PS : This is still a WIP post, and there will be additions.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"meta":{"excerpt":"An Implementation overview","slug":"service-workers-servo","title":"Basic Service Worker support lands in Servo","tags":["gsoc","open-source","rust","servo"],"date":"Wed Jun 29 2016 05:30:00 GMT+0530 (India Standard Time)","author":"creativcoder","readingTime":"4min"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"service-workers-servo"},"buildId":"C0oqtusQj9cY-EdwLN_RL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>