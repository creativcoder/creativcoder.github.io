<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>creativcoder</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/ab2a2959b9ba8661.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ab2a2959b9ba8661.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f16eaa9e44b97d3f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f16eaa9e44b97d3f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9faa89de3ee6e754.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-32a43e1092778ede.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2e588ff4f55f23af.js" defer=""></script><script src="/_next/static/chunks/167-4ae4480dee839e87.js" defer=""></script><script src="/_next/static/chunks/675-f43734e7770ea31e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-c606869ed04a3d0b.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_buildManifest.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="" style="position:fixed;top:0;left:0;height:3px;background:transparent;z-index:99999999999;width:100%"><div class="" style="height:100%;background:#4CE0B3;transition:all 500ms ease;width:0%"><div style="box-shadow:0 0 10px #4CE0B3, 0 0 10px #4CE0B3;width:5%;opacity:1;position:absolute;height:100%;transition:all 500ms ease;transform:rotate(3deg) translate(0px, -4px);left:-10rem"></div></div></div><div class="flex min-h-screen w-screen overflow-hidden flex-col items-center dark:bg-[#242729] bg-slate-200 backdrop" style="opacity:0.5;background-color:#E2E8F0"><div class="max-w-2xl md:max-w-3xl lg:max-w-4xl space-y-12 w-screen sticky"><nav class="bg-[#f6f8f9] dark:bg-[#2b2e30] dark:shadow-md m-3 rounded-lg shadow-sm backdrop-filter backdrop-blur-md bg-opacity-40 sticky top-0 mt-10"><div class="mx-auto p-4"><div class="flex justify-between"><div class="cursor-pointer flex space-x-2 items-center"><div><img src="/logo_v3.svg" width="26" class="pt-0.5 invert"/></div><div class="text-lg dark:text-white hidden md:block">creativcoder</div></div><div class="flex items-center pr-2"><ul class="hidden md:flex md:space-x-4 pr-3"><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M18.404 2.998c-.757-.754-2.077-.751-2.828.005l-1.784 1.791L11.586 7H7a.998.998 0 0 0-.939.658l-4 11c-.133.365-.042.774.232 1.049l2 2a.997.997 0 0 0 1.049.232l11-4A.998.998 0 0 0 17 17v-4.586l2.207-2.207v-.001h.001L21 8.409c.378-.378.586-.881.585-1.415 0-.535-.209-1.038-.588-1.415l-2.593-2.581zm-3.111 8.295A.996.996 0 0 0 15 12v4.3l-9.249 3.363 4.671-4.671c.026.001.052.008.078.008A1.5 1.5 0 1 0 9 13.5c0 .026.007.052.008.078l-4.671 4.671L7.7 9H12c.266 0 .52-.105.707-.293L14.5 6.914 17.086 9.5l-1.793 1.793zm3.206-3.208-2.586-2.586 1.079-1.084 2.593 2.581-1.086 1.089z"></path></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="https://youtube.com/@creativcoder"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path fill-rule="nonzero" d="M19.606 6.995c-.076-.298-.292-.523-.539-.592C18.63 6.28 16.5 6 12 6s-6.628.28-7.069.403c-.244.068-.46.293-.537.592C4.285 7.419 4 9.196 4 12s.285 4.58.394 5.006c.076.297.292.522.538.59C5.372 17.72 7.5 18 12 18s6.629-.28 7.069-.403c.244-.068.46-.293.537-.592C19.715 16.581 20 14.8 20 12s-.285-4.58-.394-5.005zm1.937-.497C22 8.28 22 12 22 12s0 3.72-.457 5.502c-.254.985-.997 1.76-1.938 2.022C17.896 20 12 20 12 20s-5.893 0-7.605-.476c-.945-.266-1.687-1.04-1.938-2.022C2 15.72 2 12 2 12s0-3.72.457-5.502c.254-.985.997-1.76 1.938-2.022C6.107 4 12 4 12 4s5.896 0 7.605.476c.945.266 1.687 1.04 1.938 2.022zM10 15.5v-7l6 3.5-6 3.5z"></path></g></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/about"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 9C16 11.2091 14.2091 13 12 13C9.79086 13 8 11.2091 8 9C8 6.79086 9.79086 5 12 5C14.2091 5 16 6.79086 16 9ZM14 9C14 10.1046 13.1046 11 12 11C10.8954 11 10 10.1046 10 9C10 7.89543 10.8954 7 12 7C13.1046 7 14 7.89543 14 9Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM3 12C3 14.0902 3.71255 16.014 4.90798 17.5417C6.55245 15.3889 9.14627 14 12.0645 14C14.9448 14 17.5092 15.3531 19.1565 17.4583C20.313 15.9443 21 14.0524 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12ZM12 21C9.84977 21 7.87565 20.2459 6.32767 18.9878C7.59352 17.1812 9.69106 16 12.0645 16C14.4084 16 16.4833 17.1521 17.7538 18.9209C16.1939 20.2191 14.1881 21 12 21Z" fill="currentColor"></path></svg></a></ul><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:hidden block"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path></svg></div></div></div></nav><div><article class="dark:text-slate-200 dark:prose-headings:text-slate-200 dark:prose-code:text-slate-200 dark:prose-blockquote:text-slate-200 dark:prose-strong:text-slate-100 dark:prose-pre:bg-zinc-900 dark:prose-pre:shadow-md dark:prose-pre:border-gray-600 dark:prose-pre:border-[1.4px] dark:prose-a:text-slate-200 prose prose-xl flex flex-col mx-auto max-w-6xl justify-center pl-6 pr-6 prose-p:m-3 prose-headings:mb-3 prose-headings:mt-3 prose-a:font-bold prose-img:rounded-lg prose-img:m-auto prose-img:w-full prose-img:shadow-lg prose-code:font-jetbrains prose-pre:p-0 prose-a:no-underline prose-h1:text-4xl prose-h1:pl-2 prose-h2:pl-2 prose-blockquote:border-slate-600 prose-h2:text-xl"><div class="flex flex-col"><p class="text-4xl font-bold">How to run Rust on Arduino Uno - Our first blink ðŸ’¡</p><div class="pt-3 flex justify-between flex-row-reverse"><div class="flex items-center space-x-2"><p class="text-sm">19th August 2020</p></div><div class="flex items-center space-x-2"><p class="text-sm tracking-wide">creativcoder<!-- --> / <!-- -->9min<!-- --></p></div></div><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div></div><p><img src="https://images.unsplash.com/photo-1667621590386-bab21d430992?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1331&amp;q=80" alt="cover image"/></p>
<!-- --><p>At the time of writing this, about a month ago, the rust-avr fork was merged <!-- --><a href="https://github.com/rust-lang/rust/issues/44052#issuecomment-663394401">upstream</a>. This means that you can now compile Rust programs for the avr microcontroller board by just running <!-- --><code>cargo +nightly build</code>, providing a <!-- --><code>.cargo/config.toml</code> for your target (<!-- --><code>avr-unknown-unknown</code>). That&#x27;s huge!<!-- --></p>
<!-- --><p>I have always been fascinated with the idea of using code to manipulate and affect physical objects. This is probably going to be a series of blog posts on my adventures with Rust on Arduino and maybe ESP8266 and discovery F3 in future. (I have these lying around too). Kicking off the series with this first post.</p>
<!-- --><p><em>Target audience</em>: This post is written with beginner to intermediate folks in mind who want a head start with embedded systems in Rust with Arduino. Once you have gone through this post, you may wanna go through the through the basics on <!-- --><a href="https://rust-embedded.github.io/book/intro/index.html">embedded rust book</a>. The code in the post is compiled on a Linux machine (Arch linux) with Rust compiler version: <!-- --><code>rustc 1.47.0-nightly (22ee68dc5 2020-08-05)</code>.<!-- --></p>
<!-- --><p>We&#x27;ll take a whirlwind tour on how to run Rust on the Arduino Uno, which is probably the most widely known and used development board in the hobbyist embedded domain. The <!-- --><a href="https://store.arduino.cc/usa/arduino-uno-rev3">Arduino Uno</a> is based on the ATmega328P, which is an 8 bit microcontroller falling under the family AVR. AVR is a family of micro-controllers developed since 1996 by Atmel, which was later acquired by Microchip technology. If you wanna read more about that, head over here: <!-- --><a href="https://book.avr-rust.com/001-introduction.html">AVR-Rust book</a></p>
<!-- --><p>With that brief history aside, let&#x27;s get into it!</p>
<!-- --><p>We&#x27;ll do the hello world of arduino which is blinking its built-in LED. It&#x27;s a very simple exercise, but there&#x27;s a lot to learn as a beginner.</p>
<!-- --><h1 id="setting-up-our-project"><a href="#setting-up-our-project">Setting up our project</a></h1>
<!-- --><p>First, we&#x27;ll create a new cargo project by running:</p>
<!-- --><pre><code class="hljs language-bash">cargo new rust-arduino-blink
</code></pre>
<!-- --><p>We&#x27;ll need to cross compile our project for the avr target (target triple:<!-- --><code>avr-unknown-unknown</code>).
For this we&#x27;ll need to switch to the nightly toolchain as some of the dependent crates use unstable features to make all of this happen. So we&#x27;ll run:<!-- --></p>
<!-- --><pre><code class="hljs language-bash">rustup override <!-- --><span class="hljs-built_in">set</span> nightly
<!-- --></code></pre>
<!-- --><p>The above command overrides the toolchain of choice for only our current directory to be nightly.</p>
<!-- --><p>Then we&#x27;ll install the required packages:</p>
<!-- --><pre><code class="hljs language-bash">pacman -S avr-gcc
</code></pre>
<!-- --><p>The <!-- --><code>avr-gcc</code> package is required to use the linker.<!-- --></p>
<!-- --><pre><code class="hljs language-bash">pacman -S arduino-avr-core
</code></pre>
<!-- --><p>The <!-- --><code>arduino-avr-core</code> package contains utilities such as <!-- --><a href="https://www.nongnu.org/avrdude/">avrdude</a> which is a tool to upload and manipulate ROM and EEPROM contents of microcontrollers using the in-system programming technique.<!-- --></p>
<!-- --><p>I am on an arch linux distro (endeavour OS) where <!-- --><code>pacman</code> is our package manager.<!-- --></p>
<!-- --><p>Then, under <!-- --><code>Cargo.toml</code> we&#x27;ll add the following dependencies:<!-- --></p>
<!-- --><pre><code class="hljs language-toml"><span class="hljs-section">[dependencies]</span>
<!-- --><span class="hljs-comment"># A panic handler is needed.  This is a crate with the most basic one.</span>
<!-- --><span class="hljs-attr">panic-halt</span> = <!-- --><span class="hljs-string">&quot;0.2.0&quot;</span>

<!-- --><span class="hljs-section">[dependencies.arduino-uno]</span>
<!-- --><span class="hljs-attr">git</span> = <!-- --><span class="hljs-string">&quot;https://github.com/Rahix/avr-hal&quot;</span>
<!-- --></code></pre>
<!-- --><p><code>avr-hal</code> is a cargo workspace that contains a bunch of crates segregated by boards where the <!-- --><code>arduino-uno</code> crate is one
of them. Thanks to <!-- --><a href="https://github.com/Rahix/avr-hal">Rahix</a> for putting this together.<!-- --></p>
<!-- --><p>We&#x27;ll also need to add build metadata for cargo for the avr target. We&#x27;ll create a file <!-- --><code>avr-atmega328p.json</code> in our project root with the following contents:<!-- --></p>
<!-- --><pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <!-- --><span class="hljs-attr">&quot;llvm-target&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;avr-unknown-unknown&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;cpu&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;atmega328p&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;target-endian&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;little&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;target-pointer-width&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;16&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;target-c-int-width&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;16&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;os&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;unknown&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;target-env&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;target-vendor&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;unknown&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;arch&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;avr&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;data-layout&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;e-P1-p:16:8-i8:8-i16:8-i32:8-i64:8-f32:8-f64:8-n8-a:8&quot;</span><span class="hljs-punctuation">,</span>
  
    <!-- --><span class="hljs-attr">&quot;executables&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  
    <!-- --><span class="hljs-attr">&quot;linker&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;avr-gcc&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;linker-flavor&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;gcc&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;pre-link-args&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-punctuation">{</span>
      <!-- --><span class="hljs-attr">&quot;gcc&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;-Os&quot;</span><span class="hljs-punctuation">,</span> <!-- --><span class="hljs-string">&quot;-mmcu=atmega328p&quot;</span><span class="hljs-punctuation">]</span>
    <!-- --><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;exe-suffix&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-string">&quot;.elf&quot;</span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;post-link-args&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-punctuation">{</span>
      <!-- --><span class="hljs-attr">&quot;gcc&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;-Wl,--gc-sections&quot;</span><span class="hljs-punctuation">]</span>
    <!-- --><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  
    <!-- --><span class="hljs-attr">&quot;singlethread&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <!-- --><span class="hljs-attr">&quot;no-builtins&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  
    <!-- --><span class="hljs-attr">&quot;no-default-libraries&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  
    <!-- --><span class="hljs-attr">&quot;eh-frame-header&quot;</span><span class="hljs-punctuation">:</span> <!-- --><span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <!-- --><span class="hljs-punctuation">}</span>
  
<!-- --></code></pre>
<!-- --><p>and reference it in <!-- --><code>.cargo/config.toml</code>:<!-- --></p>
<!-- --><pre><code class="hljs language-toml"><span class="hljs-section">[build]</span>
<!-- --><span class="hljs-attr">target</span> = <!-- --><span class="hljs-string">&quot;avr-atmega328p.json&quot;</span>

<!-- --><span class="hljs-section">[unstable]</span>
<!-- --><span class="hljs-attr">build-std</span> = [<!-- --><span class="hljs-string">&quot;core&quot;</span>]

<!-- --></code></pre>
<!-- --><p>With that, our build configuration is complete.</p>
<!-- --><h1 id="lets-write-some-code"><a href="#lets-write-some-code">Let&#x27;s write some code</a></h1>
<!-- --><p>With the dependencies aside, let&#x27;s add code under <!-- --><code>main.rs</code> and go through it incrementally:<!-- --></p>
<!-- --><p>(Quick tip: You can run <!-- --><code>cargo doc --open</code> in your directory and have a documentation of this project along with its dependencies for ready reference)<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-comment">// main.rs</span>

<!-- --><span class="hljs-meta">#![no_std]</span>
<!-- --><span class="hljs-meta">#![no_main]</span>
<!-- --></code></pre>
<!-- --><p>First we need to specify a few global attributes to let the compiler know that we are in a different environment.
We are in an embedded environment which doesn&#x27;t have functionalities that the <!-- --><a href="https://github.com/rust-lang/rust/tree/5b04bbfcbb79ed7325ea2b580458a80d95da6bbb/library/std">standard library crate</a> of Rust depends on such as heap allocation APIs, threads, network APIs etc. So we need to add the <!-- --><code>#[no_std]</code> attribute at the top. We also need to override the default entry point (<!-- --><code>fn main()</code>) using <!-- --><code>#[no_main]</code> because we are going to be providing and defining our own entry point to the program. To define our entry point, we&#x27;ll use the entry attribute macro from the <!-- --><code>arduino_uno</code> crate to define a custom entry point. Usually the board crate you use will provide an entry macro to you.<!-- --></p>
<!-- --><p>We then add <!-- --><code>use</code> statements to bring the required items in scope from the dependant crates.<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">extern</span> <!-- --><span class="hljs-keyword">crate</span> panic_halt;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::prelude::*;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::hal::port::portb::PB5;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::hal::port::mode::Output;
<!-- --></code></pre>
<!-- --><p>Notice the <!-- --><code>panic_halt</code> crate? We need a panic handler because:<!-- --></p>
<!-- --><p>In the standard library panicking has a defined behavior: it unwinds the stack of the panicking thread, unless the user opted for aborting the program on panics. In programs without standard library, however, the panicking behavior is left undefined. A behavior can be chosen by declaring a #[panic_handler] function. Source: [<!-- --><a href="https://rust-embedded.github.io/book/start/panicking.html">embedded rust book</a>]<!-- --></p>
<!-- --><p>Let&#x27;s move on:</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-meta">#[arduino_uno::entry]</span>
<!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">main</span>() <!-- --><span class="hljs-punctuation">-&gt;</span> ! {
    
}
<!-- --></code></pre>
<!-- --><p>Then we have our <!-- --><code>main</code> function annotated with the <!-- --><code>entry</code> attribute macro from the <!-- --><code>arduino_uno</code> crate. The <!-- --><code>!</code> is
the never type which denotes that the function never returns.<!-- --></p>
<!-- --><p>To blink the LED, we only need a few lines of code and set the relevant pin high or low. Let&#x27;s take a look at the pin diagram of the ATmega328P chip on Uno:</p>
<!-- --><p><img src="https://components101.com/sites/default/files/inline-images/ATMega328P-Arduino-Uno-Pin-Mapping.png" alt="ATmega328P chip diagram"/></p>
<!-- --><p>In the diagram above, you can notice various pins on the microcontroller. Most microcontrollers, if not all, contain pins that allow the device to both read and write digital values to external circuits. Some of them are categorized as I/O ports.
A port is a group of pins representing a standard interface. These ports are controlled by port registers, which can be thought of as a special byte variable that we can change in our code.</p>
<!-- --><p>In case of ATmega328P, we have three port registers to work with:</p>
<!-- --><ul>
<!-- --><li>C â€“ for analogue pins 0 to 5</li>
<!-- --><li>D â€“ for digital pins 0 to 7</li>
<!-- --><li>B â€“ for digital pins 8 to 13</li>
<!-- --></ul>
<!-- --><p>The details are explained better here: <!-- --><a href="https://www.arduino.cc/en/Reference/PortManipulation">Port Manipulation</a></p>
<!-- --><p>If you look at the Uno, we have the digital Pin 13 which is connected to the built-in LED.
We need access to the pin in our code in order to manipulate the LED, i.e., set it high or low.</p>
<!-- --><p>Let&#x27;s add more code:</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-meta">#[arduino_uno::entry]</span>
<!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">main</span>() <!-- --><span class="hljs-punctuation">-&gt;</span> ! {
    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword"></span><span class="hljs-variable">peripherals</span> = arduino_uno::Peripherals::<!-- --><span class="hljs-title function_ invoke__">take</span>().<!-- --><span class="hljs-title function_ invoke__">unwrap</span>();

    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword">mut </span><span class="hljs-variable">pins</span> = arduino_uno::Pins::<!-- --><span class="hljs-title function_ invoke__">new</span>(
        peripherals.PORTB,
        peripherals.PORTC,
        peripherals.PORTD,
    );

    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword">mut </span><span class="hljs-variable">led</span> = pins.d13.<!-- --><span class="hljs-title function_ invoke__">into_output</span>(&amp;<!-- --><span class="hljs-keyword">mut</span> pins.ddr);
    
    <!-- --><span class="hljs-keyword">loop</span> {
        <!-- --><span class="hljs-title function_ invoke__">stutter_blink</span>(&amp;<!-- --><span class="hljs-keyword">mut</span> led, <!-- --><span class="hljs-number">25</span>);
    }
}
<!-- --></code></pre>
<!-- --><p>There&#x27;s a lot going on in the code above!</p>
<!-- --><p>First, we create an instance of <!-- --><code>Peripherals</code> which is a list of all peripherals in Uno.
Peripherals are devices that bridge the communication with your chip/cpu with external devices, sensors etc.
Examples of peripherals would be your timers, counters, serial port etc.
An embedded processor interacts with a peripheral device through a set of control and status registers.<!-- --></p>
<!-- --><p>We then create a new <!-- --><code>Pin</code> instance passing in the ports from the peripheral instance <!-- --><code>peripherals</code>.
We then define a variable <!-- --><code>led</code> that will hold the pin number that the LED is connected to. This is created by configuring pin 13 as output pin using the <!-- --><code>into_output</code> method of the <!-- --><code>d13</code> pin and passing in a mutable reference to our <!-- --><code>ddr</code> register.<!-- --></p>
<!-- --><p>DDR register determines if pins on a specific port are inputs or outputs. The DDR register is 8 bits long and each bit corresponds to a pin on that I/O port. For example, the first bit (bit 0) of DDRB will determine if PB0 is an input or output, while the last bit (bit 7) will determine if PB7 is an input or output. I still need to do a bit more reading to fully understand DDR registers.</p>
<!-- --><p>Next, we go into a <!-- --><code>loop {}</code> and call <!-- --><code>stutter_blink</code> function providing a mutable reference to our <!-- --><code>led</code> instance
and number of times (<!-- --><code>25</code>) that we want to blink.<!-- --></p>
<!-- --><p>Here&#x27;s our <!-- --><code>stutter_blink</code> function definition:<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">stutter_blink</span>(led: &amp;<!-- --><span class="hljs-keyword">mut</span> PB5&lt;Output&gt;, times: <!-- --><span class="hljs-type">usize</span>) {
    (<!-- --><span class="hljs-number">0</span>..times).<!-- --><span class="hljs-title function_ invoke__">map</span>(|i| i * <!-- --><span class="hljs-number">10</span>).<!-- --><span class="hljs-title function_ invoke__">for_each</span>(|i| {
        led.<!-- --><span class="hljs-title function_ invoke__">toggle</span>().<!-- --><span class="hljs-title function_ invoke__">void_unwrap</span>();
        arduino_uno::<!-- --><span class="hljs-title function_ invoke__">delay_ms</span>(i <!-- --><span class="hljs-keyword">as</span> <!-- --><span class="hljs-type">u16</span>);
    });
}
<!-- --></code></pre>
<!-- --><p>All we do in <!-- --><code>stutter_blink</code> is call toggle on <!-- --><code>led</code> followed by a <!-- --><code>delay_ms</code> call from the <!-- --><code>arduino_uno</code> module.
This is all done in an iterator. We create a range <!-- --><code>(0..times)</code> followed by calling <!-- --><code>map</code> so that we can progressively delay the LED toggle by a noticeable amount. We could have definitely done this using a for loop and that would be more readable, but I wanted to demonstrate that we can use all the high level APIs and abstractions from Rust.
We are writing functional code for an embedded systems where the abstractions are zero cost.
That&#x27;s a thing possible only in Rust as far as I know!<!-- --></p>
<!-- --><p>Here&#x27;s the full code:</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-comment">// main.rs</span>

<!-- --><span class="hljs-meta">#![no_std]</span>
<!-- --><span class="hljs-meta">#![no_main]</span>

<!-- --><span class="hljs-keyword">extern</span> <!-- --><span class="hljs-keyword">crate</span> panic_halt;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::prelude::*;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::hal::port::portb::PB5;
<!-- --><span class="hljs-keyword">use</span> arduino_uno::hal::port::mode::Output;

<!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">stutter_blink</span>(led: &amp;<!-- --><span class="hljs-keyword">mut</span> PB5&lt;Output&gt;, times: <!-- --><span class="hljs-type">usize</span>) {
    (<!-- --><span class="hljs-number">0</span>..times).<!-- --><span class="hljs-title function_ invoke__">map</span>(|i| i * <!-- --><span class="hljs-number">10</span>).<!-- --><span class="hljs-title function_ invoke__">for_each</span>(|i| {
        led.<!-- --><span class="hljs-title function_ invoke__">toggle</span>().<!-- --><span class="hljs-title function_ invoke__">void_unwrap</span>();
        arduino_uno::<!-- --><span class="hljs-title function_ invoke__">delay_ms</span>(i <!-- --><span class="hljs-keyword">as</span> <!-- --><span class="hljs-type">u16</span>);
    });
}

<!-- --><span class="hljs-meta">#[arduino_uno::entry]</span>
<!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">main</span>() <!-- --><span class="hljs-punctuation">-&gt;</span> ! {
    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword"></span><span class="hljs-variable">peripherals</span> = arduino_uno::Peripherals::<!-- --><span class="hljs-title function_ invoke__">take</span>().<!-- --><span class="hljs-title function_ invoke__">unwrap</span>();

    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword">mut </span><span class="hljs-variable">pins</span> = arduino_uno::Pins::<!-- --><span class="hljs-title function_ invoke__">new</span>(
        peripherals.PORTB,
        peripherals.PORTC,
        peripherals.PORTD,
    );

    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword">mut </span><span class="hljs-variable">led</span> = pins.d13.<!-- --><span class="hljs-title function_ invoke__">into_output</span>(&amp;<!-- --><span class="hljs-keyword">mut</span> pins.ddr);
    
    <!-- --><span class="hljs-keyword">loop</span> {
        <!-- --><span class="hljs-title function_ invoke__">stutter_blink</span>(&amp;<!-- --><span class="hljs-keyword">mut</span> led, <!-- --><span class="hljs-number">25</span>);
    }
}

<!-- --></code></pre>
<!-- --><p>Let&#x27;s try to build this crate:</p>
<!-- --><pre><code class="hljs language-bash">cargo build
</code></pre>
<!-- --><p>If all went fine, you should see an elf file  <!-- --><code>rust-arduino-blink.elf</code> generated under <!-- --><code>target/avr-atmega328p/debug/</code> directory. That&#x27;s the binary we need to flash to our Uno. To flash the elf file, we&#x27;ll use the <!-- --><code>avrdude</code> utility. Let&#x27;s create a script at the root directory named <!-- --><code>flash.sh</code> that does <!-- --><code>cargo build</code> followed by flashing it our uno:<!-- --></p>
<!-- --><pre><code class="hljs language-bash"><span class="hljs-meta">#! /usr/bin/zsh</span>

<!-- --><span class="hljs-built_in">set</span> -e

<!-- --><span class="hljs-keyword">if</span> [ <!-- --><span class="hljs-string">&quot;<!-- --><span class="hljs-variable">$1</span>&quot;<!-- --></span> = <!-- --><span class="hljs-string">&quot;--help&quot;</span> ] || [ <!-- --><span class="hljs-string">&quot;<!-- --><span class="hljs-variable">$1</span>&quot;<!-- --></span> = <!-- --><span class="hljs-string">&quot;-h&quot;</span> ]; <!-- --><span class="hljs-keyword">then</span>
    <!-- --><span class="hljs-built_in">echo</span> <!-- --><span class="hljs-string">&quot;usage: <!-- --><span class="hljs-variable">$0</span> &lt;path-to-binary.elf&gt;&quot;<!-- --></span> &gt;&amp;2
    <!-- --><span class="hljs-built_in">exit</span> 1
<!-- --><span class="hljs-keyword">fi</span>

<!-- --><span class="hljs-keyword">if</span> [ <!-- --><span class="hljs-string">&quot;<!-- --><span class="hljs-variable">$#</span>&quot;<!-- --></span> -lt 1 ]; <!-- --><span class="hljs-keyword">then</span>
    <!-- --><span class="hljs-built_in">echo</span> <!-- --><span class="hljs-string">&quot;<!-- --><span class="hljs-variable">$0</span>: Expecting a .elf file&quot;<!-- --></span> &gt;&amp;2
    <!-- --><span class="hljs-built_in">exit</span> 1
<!-- --><span class="hljs-keyword">fi</span>

sudo -u creativcoder cargo build
avrdude -q -C/etc/avrdude.conf -patmega328p -carduino -P/dev/ttyACM0 -D <!-- --><span class="hljs-string">&quot;-Uflash:w:<!-- --><span class="hljs-variable">$1</span>:e&quot;<!-- --></span>

<!-- --></code></pre>
<!-- --><p>With that, we can now run (make sure your Uno is connected via the USB cable):</p>
<!-- --><pre><code class="hljs language-bash">./flash.sh target/avr-atmega328p/debug/rust-arduino-blink.elf
</code></pre>
<!-- --><p>and there you go:</p>
<!-- --><p><img src="https://media.giphy.com/media/gFtGud1j5fNAl5yzlu/giphy.gif" alt="Rust on arduino"/></p>
<!-- --><p>Our first blinking program on Arduino running Rust!</p>
<!-- --><p>If you get a permission denied error when accessing <!-- --><code>/dev/ttyACM0</code>. You may need to add your user
to a linux user group that has access to the serial interface.
First, we find the group using:<!-- --></p>
<!-- --><pre><code class="hljs language-bash"><span class="hljs-built_in">ls</span> -l /dev/ttyACM0
<!-- --></code></pre>
<!-- --><p>I get the following output on my machine:</p>
<!-- --><pre><code class="hljs language-bash">crw-rw---- 1 root uucp 166, 0 Aug 19 03:29 /dev/ttyACM0
</code></pre>
<!-- --><p>To add your username to <!-- --><code>uucp</code> group, we run:<!-- --></p>
<!-- --><pre><code class="hljs language-bash">sudo usermod -a -G uucp creativcoder
</code></pre>
<!-- --><p>Suggestions/comments/corrections most welcome.</p>
<!-- --><p>I have several embedded hobby projects in plan, I will be writing about them in future as they progress. Here&#x27;s the <!-- --><a href="https://github.com/creativcoder/rust-arduino-blink">Github</a> for the code above.
If you want to follow the latest in developement in Rust embedded space, follow the <!-- --><a href="https://rust-embedded.github.io/blog/newsletter-24/">embedded rust working group</a></p>
<!-- --><p>Until next time!</p><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div><p class="text-sm font-bold">Want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please follow Rust&#x27;s code of conduct. This comment thread directly maps to a discussion on GitHub, so you can also comment there if you prefer.</p></article>;<!-- --></div><footer class="flex flex-col items-center w-full"><div class="px-4 py-2 flex items-center justify-center space-x-2 border-2 rounded-md border-gray-500 hover:bg-blue-100 transition-colors hover:text-lime-900"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"></path></svg><p>Be a GitHub Sponser</p></div><div class="flex-col items-center justify-center mt-8 mb-8"><div class="text-center text-xs mx-auto">Â© 2016-<!-- -->2022<!-- --> creativcoder. All rights reserved.<!-- --></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    a: \"a\",\n    code: \"code\",\n    em: \"em\",\n    h1: \"h1\",\n    pre: \"pre\",\n    span: \"span\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://images.unsplash.com/photo-1667621590386-bab21d430992?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1331\u0026q=80\",\n        alt: \"cover image\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"At the time of writing this, about a month ago, the rust-avr fork was merged \", _jsx(_components.a, {\n        href: \"https://github.com/rust-lang/rust/issues/44052#issuecomment-663394401\",\n        children: \"upstream\"\n      }), \". This means that you can now compile Rust programs for the avr microcontroller board by just running \", _jsx(_components.code, {\n        children: \"cargo +nightly build\"\n      }), \", providing a \", _jsx(_components.code, {\n        children: \".cargo/config.toml\"\n      }), \" for your target (\", _jsx(_components.code, {\n        children: \"avr-unknown-unknown\"\n      }), \"). That's huge!\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I have always been fascinated with the idea of using code to manipulate and affect physical objects. This is probably going to be a series of blog posts on my adventures with Rust on Arduino and maybe ESP8266 and discovery F3 in future. (I have these lying around too). Kicking off the series with this first post.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.em, {\n        children: \"Target audience\"\n      }), \": This post is written with beginner to intermediate folks in mind who want a head start with embedded systems in Rust with Arduino. Once you have gone through this post, you may wanna go through the through the basics on \", _jsx(_components.a, {\n        href: \"https://rust-embedded.github.io/book/intro/index.html\",\n        children: \"embedded rust book\"\n      }), \". The code in the post is compiled on a Linux machine (Arch linux) with Rust compiler version: \", _jsx(_components.code, {\n        children: \"rustc 1.47.0-nightly (22ee68dc5 2020-08-05)\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We'll take a whirlwind tour on how to run Rust on the Arduino Uno, which is probably the most widely known and used development board in the hobbyist embedded domain. The \", _jsx(_components.a, {\n        href: \"https://store.arduino.cc/usa/arduino-uno-rev3\",\n        children: \"Arduino Uno\"\n      }), \" is based on the ATmega328P, which is an 8 bit microcontroller falling under the family AVR. AVR is a family of micro-controllers developed since 1996 by Atmel, which was later acquired by Microchip technology. If you wanna read more about that, head over here: \", _jsx(_components.a, {\n        href: \"https://book.avr-rust.com/001-introduction.html\",\n        children: \"AVR-Rust book\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With that brief history aside, let's get into it!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We'll do the hello world of arduino which is blinking its built-in LED. It's a very simple exercise, but there's a lot to learn as a beginner.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      id: \"setting-up-our-project\",\n      children: _jsx(_components.a, {\n        href: \"#setting-up-our-project\",\n        children: \"Setting up our project\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"First, we'll create a new cargo project by running:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"cargo new rust-arduino-blink\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We'll need to cross compile our project for the avr target (target triple:\", _jsx(_components.code, {\n        children: \"avr-unknown-unknown\"\n      }), \").\\nFor this we'll need to switch to the nightly toolchain as some of the dependent crates use unstable features to make all of this happen. So we'll run:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [\"rustup override \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"set\"\n        }), \" nightly\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The above command overrides the toolchain of choice for only our current directory to be nightly.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then we'll install the required packages:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"pacman -S avr-gcc\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"avr-gcc\"\n      }), \" package is required to use the linker.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"pacman -S arduino-avr-core\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"arduino-avr-core\"\n      }), \" package contains utilities such as \", _jsx(_components.a, {\n        href: \"https://www.nongnu.org/avrdude/\",\n        children: \"avrdude\"\n      }), \" which is a tool to upload and manipulate ROM and EEPROM contents of microcontrollers using the in-system programming technique.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I am on an arch linux distro (endeavour OS) where \", _jsx(_components.code, {\n        children: \"pacman\"\n      }), \" is our package manager.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, under \", _jsx(_components.code, {\n        children: \"Cargo.toml\"\n      }), \" we'll add the following dependencies:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-toml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-section\",\n          children: \"[dependencies]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# A panic handler is needed.  This is a crate with the most basic one.\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"panic-halt\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"0.2.0\\\"\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-section\",\n          children: \"[dependencies.arduino-uno]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"git\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"https://github.com/Rahix/avr-hal\\\"\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"avr-hal\"\n      }), \" is a cargo workspace that contains a bunch of crates segregated by boards where the \", _jsx(_components.code, {\n        children: \"arduino-uno\"\n      }), \" crate is one\\nof them. Thanks to \", _jsx(_components.a, {\n        href: \"https://github.com/Rahix/avr-hal\",\n        children: \"Rahix\"\n      }), \" for putting this together.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We'll also need to add build metadata for cargo for the avr target. We'll create a file \", _jsx(_components.code, {\n        children: \"avr-atmega328p.json\"\n      }), \" in our project root with the following contents:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-json\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"{\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"llvm-target\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"avr-unknown-unknown\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"cpu\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"atmega328p\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"target-endian\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"little\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"target-pointer-width\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"16\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"target-c-int-width\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"16\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"os\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"unknown\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"target-env\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"target-vendor\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"unknown\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"arch\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"avr\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"data-layout\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"e-P1-p:16:8-i8:8-i16:8-i32:8-i64:8-f32:8-f64:8-n8-a:8\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n  \\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"executables\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"true\"\n          })\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n  \\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"linker\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"avr-gcc\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"linker-flavor\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gcc\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"pre-link-args\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"{\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"gcc\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"-Os\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"-mmcu=atmega328p\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"]\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"}\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"exe-suffix\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\".elf\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"post-link-args\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"{\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"gcc\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"-Wl,--gc-sections\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"]\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"}\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n  \\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"singlethread\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"false\"\n          })\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"no-builtins\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"false\"\n          })\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n  \\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"no-default-libraries\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"false\"\n          })\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \",\"\n        }), \"\\n  \\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"\\\"eh-frame-header\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"false\"\n          })\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"}\"\n        }), \"\\n  \\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"and reference it in \", _jsx(_components.code, {\n        children: \".cargo/config.toml\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-toml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-section\",\n          children: \"[build]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"target\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"avr-atmega328p.json\\\"\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-section\",\n          children: \"[unstable]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"build-std\"\n        }), \" = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"core\\\"\"\n        }), \"]\\n\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With that, our build configuration is complete.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      id: \"lets-write-some-code\",\n      children: _jsx(_components.a, {\n        href: \"#lets-write-some-code\",\n        children: \"Let's write some code\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"With the dependencies aside, let's add code under \", _jsx(_components.code, {\n        children: \"main.rs\"\n      }), \" and go through it incrementally:\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"(Quick tip: You can run \", _jsx(_components.code, {\n        children: \"cargo doc --open\"\n      }), \" in your directory and have a documentation of this project along with its dependencies for ready reference)\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// main.rs\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#![no_std]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#![no_main]\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First we need to specify a few global attributes to let the compiler know that we are in a different environment.\\nWe are in an embedded environment which doesn't have functionalities that the \", _jsx(_components.a, {\n        href: \"https://github.com/rust-lang/rust/tree/5b04bbfcbb79ed7325ea2b580458a80d95da6bbb/library/std\",\n        children: \"standard library crate\"\n      }), \" of Rust depends on such as heap allocation APIs, threads, network APIs etc. So we need to add the \", _jsx(_components.code, {\n        children: \"#[no_std]\"\n      }), \" attribute at the top. We also need to override the default entry point (\", _jsx(_components.code, {\n        children: \"fn main()\"\n      }), \") using \", _jsx(_components.code, {\n        children: \"#[no_main]\"\n      }), \" because we are going to be providing and defining our own entry point to the program. To define our entry point, we'll use the entry attribute macro from the \", _jsx(_components.code, {\n        children: \"arduino_uno\"\n      }), \" crate to define a custom entry point. Usually the board crate you use will provide an entry macro to you.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We then add \", _jsx(_components.code, {\n        children: \"use\"\n      }), \" statements to bring the required items in scope from the dependant crates.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"extern\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"crate\"\n        }), \" panic_halt;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::prelude::*;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::hal::port::portb::PB5;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::hal::port::mode::Output;\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Notice the \", _jsx(_components.code, {\n        children: \"panic_halt\"\n      }), \" crate? We need a panic handler because:\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the standard library panicking has a defined behavior: it unwinds the stack of the panicking thread, unless the user opted for aborting the program on panics. In programs without standard library, however, the panicking behavior is left undefined. A behavior can be chosen by declaring a #[panic_handler] function. Source: [\", _jsx(_components.a, {\n        href: \"https://rust-embedded.github.io/book/start/panicking.html\",\n        children: \"embedded rust book\"\n      }), \"]\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's move on:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#[arduino_uno::entry]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), \"() \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" ! {\\n    \\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then we have our \", _jsx(_components.code, {\n        children: \"main\"\n      }), \" function annotated with the \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \" attribute macro from the \", _jsx(_components.code, {\n        children: \"arduino_uno\"\n      }), \" crate. The \", _jsx(_components.code, {\n        children: \"!\"\n      }), \" is\\nthe never type which denotes that the function never returns.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"To blink the LED, we only need a few lines of code and set the relevant pin high or low. Let's take a look at the pin diagram of the ATmega328P chip on Uno:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://components101.com/sites/default/files/inline-images/ATMega328P-Arduino-Uno-Pin-Mapping.png\",\n        alt: \"ATmega328P chip diagram\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In the diagram above, you can notice various pins on the microcontroller. Most microcontrollers, if not all, contain pins that allow the device to both read and write digital values to external circuits. Some of them are categorized as I/O ports.\\nA port is a group of pins representing a standard interface. These ports are controlled by port registers, which can be thought of as a special byte variable that we can change in our code.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In case of ATmega328P, we have three port registers to work with:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"C â€“ for analogue pins 0 to 5\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"D â€“ for digital pins 0 to 7\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"B â€“ for digital pins 8 to 13\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The details are explained better here: \", _jsx(_components.a, {\n        href: \"https://www.arduino.cc/en/Reference/PortManipulation\",\n        children: \"Port Manipulation\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If you look at the Uno, we have the digital Pin 13 which is connected to the built-in LED.\\nWe need access to the pin in our code in order to manipulate the LED, i.e., set it high or low.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's add more code:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#[arduino_uno::entry]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), \"() \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" ! {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"peripherals\"\n        }), \" = arduino_uno::Peripherals::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"take\"\n        }), \"().\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"unwrap\"\n        }), \"();\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut \"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"pins\"\n        }), \" = arduino_uno::Pins::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"new\"\n        }), \"(\\n        peripherals.PORTB,\\n        peripherals.PORTC,\\n        peripherals.PORTD,\\n    );\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut \"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"led\"\n        }), \" = pins.d13.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"into_output\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" pins.ddr);\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"loop\"\n        }), \" {\\n        \", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"stutter_blink\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" led, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"25\"\n        }), \");\\n    }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There's a lot going on in the code above!\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, we create an instance of \", _jsx(_components.code, {\n        children: \"Peripherals\"\n      }), \" which is a list of all peripherals in Uno.\\nPeripherals are devices that bridge the communication with your chip/cpu with external devices, sensors etc.\\nExamples of peripherals would be your timers, counters, serial port etc.\\nAn embedded processor interacts with a peripheral device through a set of control and status registers.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We then create a new \", _jsx(_components.code, {\n        children: \"Pin\"\n      }), \" instance passing in the ports from the peripheral instance \", _jsx(_components.code, {\n        children: \"peripherals\"\n      }), \".\\nWe then define a variable \", _jsx(_components.code, {\n        children: \"led\"\n      }), \" that will hold the pin number that the LED is connected to. This is created by configuring pin 13 as output pin using the \", _jsx(_components.code, {\n        children: \"into_output\"\n      }), \" method of the \", _jsx(_components.code, {\n        children: \"d13\"\n      }), \" pin and passing in a mutable reference to our \", _jsx(_components.code, {\n        children: \"ddr\"\n      }), \" register.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"DDR register determines if pins on a specific port are inputs or outputs. The DDR register is 8 bits long and each bit corresponds to a pin on that I/O port. For example, the first bit (bit 0) of DDRB will determine if PB0 is an input or output, while the last bit (bit 7) will determine if PB7 is an input or output. I still need to do a bit more reading to fully understand DDR registers.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next, we go into a \", _jsx(_components.code, {\n        children: \"loop {}\"\n      }), \" and call \", _jsx(_components.code, {\n        children: \"stutter_blink\"\n      }), \" function providing a mutable reference to our \", _jsx(_components.code, {\n        children: \"led\"\n      }), \" instance\\nand number of times (\", _jsx(_components.code, {\n        children: \"25\"\n      }), \") that we want to blink.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here's our \", _jsx(_components.code, {\n        children: \"stutter_blink\"\n      }), \" function definition:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"stutter_blink\"\n        }), \"(led: \u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" PB5\u003cOutput\u003e, times: \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"usize\"\n        }), \") {\\n    (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"..times).\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"map\"\n        }), \"(|i| i * \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"for_each\"\n        }), \"(|i| {\\n        led.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"toggle\"\n        }), \"().\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"void_unwrap\"\n        }), \"();\\n        arduino_uno::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"delay_ms\"\n        }), \"(i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"as\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"u16\"\n        }), \");\\n    });\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"All we do in \", _jsx(_components.code, {\n        children: \"stutter_blink\"\n      }), \" is call toggle on \", _jsx(_components.code, {\n        children: \"led\"\n      }), \" followed by a \", _jsx(_components.code, {\n        children: \"delay_ms\"\n      }), \" call from the \", _jsx(_components.code, {\n        children: \"arduino_uno\"\n      }), \" module.\\nThis is all done in an iterator. We create a range \", _jsx(_components.code, {\n        children: \"(0..times)\"\n      }), \" followed by calling \", _jsx(_components.code, {\n        children: \"map\"\n      }), \" so that we can progressively delay the LED toggle by a noticeable amount. We could have definitely done this using a for loop and that would be more readable, but I wanted to demonstrate that we can use all the high level APIs and abstractions from Rust.\\nWe are writing functional code for an embedded systems where the abstractions are zero cost.\\nThat's a thing possible only in Rust as far as I know!\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here's the full code:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// main.rs\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#![no_std]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#![no_main]\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"extern\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"crate\"\n        }), \" panic_halt;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::prelude::*;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::hal::port::portb::PB5;\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" arduino_uno::hal::port::mode::Output;\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"stutter_blink\"\n        }), \"(led: \u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" PB5\u003cOutput\u003e, times: \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"usize\"\n        }), \") {\\n    (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"..times).\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"map\"\n        }), \"(|i| i * \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"for_each\"\n        }), \"(|i| {\\n        led.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"toggle\"\n        }), \"().\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"void_unwrap\"\n        }), \"();\\n        arduino_uno::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"delay_ms\"\n        }), \"(i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"as\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"u16\"\n        }), \");\\n    });\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#[arduino_uno::entry]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), \"() \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" ! {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"peripherals\"\n        }), \" = arduino_uno::Peripherals::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"take\"\n        }), \"().\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"unwrap\"\n        }), \"();\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut \"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"pins\"\n        }), \" = arduino_uno::Pins::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"new\"\n        }), \"(\\n        peripherals.PORTB,\\n        peripherals.PORTC,\\n        peripherals.PORTD,\\n    );\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut \"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"led\"\n        }), \" = pins.d13.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"into_output\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" pins.ddr);\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"loop\"\n        }), \" {\\n        \", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"stutter_blink\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"mut\"\n        }), \" led, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"25\"\n        }), \");\\n    }\\n}\\n\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's try to build this crate:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"cargo build\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If all went fine, you should see an elf file  \", _jsx(_components.code, {\n        children: \"rust-arduino-blink.elf\"\n      }), \" generated under \", _jsx(_components.code, {\n        children: \"target/avr-atmega328p/debug/\"\n      }), \" directory. That's the binary we need to flash to our Uno. To flash the elf file, we'll use the \", _jsx(_components.code, {\n        children: \"avrdude\"\n      }), \" utility. Let's create a script at the root directory named \", _jsx(_components.code, {\n        children: \"flash.sh\"\n      }), \" that does \", _jsx(_components.code, {\n        children: \"cargo build\"\n      }), \" followed by flashing it our uno:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#! /usr/bin/zsh\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"set\"\n        }), \" -e\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" [ \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$1\"\n          }), \"\\\"\"]\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"--help\\\"\"\n        }), \" ] || [ \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$1\"\n          }), \"\\\"\"]\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"-h\\\"\"\n        }), \" ]; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"then\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"echo\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"usage: \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$0\"\n          }), \" \u003cpath-to-binary.elf\u003e\\\"\"]\n        }), \" \u003e\u00262\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"exit\"\n        }), \" 1\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fi\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" [ \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$#\"\n          }), \"\\\"\"]\n        }), \" -lt 1 ]; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"then\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"echo\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$0\"\n          }), \": Expecting a .elf file\\\"\"]\n        }), \" \u003e\u00262\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"exit\"\n        }), \" 1\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fi\"\n        }), \"\\n\\nsudo -u creativcoder cargo build\\navrdude -q -C/etc/avrdude.conf -patmega328p -carduino -P/dev/ttyACM0 -D \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"-Uflash:w:\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$1\"\n          }), \":e\\\"\"]\n        }), \"\\n\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With that, we can now run (make sure your Uno is connected via the USB cable):\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"./flash.sh target/avr-atmega328p/debug/rust-arduino-blink.elf\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"and there you go:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://media.giphy.com/media/gFtGud1j5fNAl5yzlu/giphy.gif\",\n        alt: \"Rust on arduino\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Our first blinking program on Arduino running Rust!\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you get a permission denied error when accessing \", _jsx(_components.code, {\n        children: \"/dev/ttyACM0\"\n      }), \". You may need to add your user\\nto a linux user group that has access to the serial interface.\\nFirst, we find the group using:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"ls\"\n        }), \" -l /dev/ttyACM0\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I get the following output on my machine:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"crw-rw---- 1 root uucp 166, 0 Aug 19 03:29 /dev/ttyACM0\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To add your username to \", _jsx(_components.code, {\n        children: \"uucp\"\n      }), \" group, we run:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-bash\",\n        children: \"sudo usermod -a -G uucp creativcoder\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Suggestions/comments/corrections most welcome.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I have several embedded hobby projects in plan, I will be writing about them in future as they progress. Here's the \", _jsx(_components.a, {\n        href: \"https://github.com/creativcoder/rust-arduino-blink\",\n        children: \"Github\"\n      }), \" for the code above.\\nIf you want to follow the latest in developement in Rust embedded space, follow the \", _jsx(_components.a, {\n        href: \"https://rust-embedded.github.io/blog/newsletter-24/\",\n        children: \"embedded rust working group\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Until next time!\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"meta":{"excerpt":"A whirlwind tour on quickly getting up and running with Rust on Arduino","slug":"rust-on-arduino-uno","title":"How to run Rust on Arduino Uno - Our first blink ðŸ’¡","tags":["arduino","blink","embedded","rust","uno"],"date":"Wed Aug 19 2020 05:30:00 GMT+0530 (India Standard Time)","author":"creativcoder","readingTime":"9min"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"rust-on-arduino-uno"},"buildId":"C0oqtusQj9cY-EdwLN_RL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>