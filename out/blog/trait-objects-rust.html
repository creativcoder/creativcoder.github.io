<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>creativcoder</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/ab2a2959b9ba8661.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ab2a2959b9ba8661.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f16eaa9e44b97d3f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f16eaa9e44b97d3f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9faa89de3ee6e754.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-32a43e1092778ede.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2e588ff4f55f23af.js" defer=""></script><script src="/_next/static/chunks/167-4ae4480dee839e87.js" defer=""></script><script src="/_next/static/chunks/675-f43734e7770ea31e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-c606869ed04a3d0b.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_buildManifest.js" defer=""></script><script src="/_next/static/C0oqtusQj9cY-EdwLN_RL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="" style="position:fixed;top:0;left:0;height:3px;background:transparent;z-index:99999999999;width:100%"><div class="" style="height:100%;background:#4CE0B3;transition:all 500ms ease;width:0%"><div style="box-shadow:0 0 10px #4CE0B3, 0 0 10px #4CE0B3;width:5%;opacity:1;position:absolute;height:100%;transition:all 500ms ease;transform:rotate(3deg) translate(0px, -4px);left:-10rem"></div></div></div><div class="flex min-h-screen w-screen overflow-hidden flex-col items-center dark:bg-[#242729] bg-slate-200 backdrop" style="opacity:0.5;background-color:#E2E8F0"><div class="max-w-2xl md:max-w-3xl lg:max-w-4xl space-y-12 w-screen sticky"><nav class="bg-[#f6f8f9] dark:bg-[#2b2e30] dark:shadow-md m-3 rounded-lg shadow-sm backdrop-filter backdrop-blur-md bg-opacity-40 sticky top-0 mt-10"><div class="mx-auto p-4"><div class="flex justify-between"><div class="cursor-pointer flex space-x-2 items-center"><div><img src="/logo_v3.svg" width="26" class="pt-0.5 invert"/></div><div class="text-lg dark:text-white hidden md:block">creativcoder</div></div><div class="flex items-center pr-2"><ul class="hidden md:flex md:space-x-4 pr-3"><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M18.404 2.998c-.757-.754-2.077-.751-2.828.005l-1.784 1.791L11.586 7H7a.998.998 0 0 0-.939.658l-4 11c-.133.365-.042.774.232 1.049l2 2a.997.997 0 0 0 1.049.232l11-4A.998.998 0 0 0 17 17v-4.586l2.207-2.207v-.001h.001L21 8.409c.378-.378.586-.881.585-1.415 0-.535-.209-1.038-.588-1.415l-2.593-2.581zm-3.111 8.295A.996.996 0 0 0 15 12v4.3l-9.249 3.363 4.671-4.671c.026.001.052.008.078.008A1.5 1.5 0 1 0 9 13.5c0 .026.007.052.008.078l-4.671 4.671L7.7 9H12c.266 0 .52-.105.707-.293L14.5 6.914 17.086 9.5l-1.793 1.793zm3.206-3.208-2.586-2.586 1.079-1.084 2.593 2.581-1.086 1.089z"></path></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="https://youtube.com/@creativcoder"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path fill-rule="nonzero" d="M19.606 6.995c-.076-.298-.292-.523-.539-.592C18.63 6.28 16.5 6 12 6s-6.628.28-7.069.403c-.244.068-.46.293-.537.592C4.285 7.419 4 9.196 4 12s.285 4.58.394 5.006c.076.297.292.522.538.59C5.372 17.72 7.5 18 12 18s6.629-.28 7.069-.403c.244-.068.46-.293.537-.592C19.715 16.581 20 14.8 20 12s-.285-4.58-.394-5.005zm1.937-.497C22 8.28 22 12 22 12s0 3.72-.457 5.502c-.254.985-.997 1.76-1.938 2.022C17.896 20 12 20 12 20s-5.893 0-7.605-.476c-.945-.266-1.687-1.04-1.938-2.022C2 15.72 2 12 2 12s0-3.72.457-5.502c.254-.985.997-1.76 1.938-2.022C6.107 4 12 4 12 4s5.896 0 7.605.476c.945.266 1.687 1.04 1.938 2.022zM10 15.5v-7l6 3.5-6 3.5z"></path></g></svg></a><a class="hover:text-slate-500 dark:text-slate-200 text-slate-700 transition flex items-center" href="/about"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 9C16 11.2091 14.2091 13 12 13C9.79086 13 8 11.2091 8 9C8 6.79086 9.79086 5 12 5C14.2091 5 16 6.79086 16 9ZM14 9C14 10.1046 13.1046 11 12 11C10.8954 11 10 10.1046 10 9C10 7.89543 10.8954 7 12 7C13.1046 7 14 7.89543 14 9Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM3 12C3 14.0902 3.71255 16.014 4.90798 17.5417C6.55245 15.3889 9.14627 14 12.0645 14C14.9448 14 17.5092 15.3531 19.1565 17.4583C20.313 15.9443 21 14.0524 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12ZM12 21C9.84977 21 7.87565 20.2459 6.32767 18.9878C7.59352 17.1812 9.69106 16 12.0645 16C14.4084 16 16.4833 17.1521 17.7538 18.9209C16.1939 20.2191 14.1881 21 12 21Z" fill="currentColor"></path></svg></a></ul><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:hidden block"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path></svg></div></div></div></nav><div><article class="dark:text-slate-200 dark:prose-headings:text-slate-200 dark:prose-code:text-slate-200 dark:prose-blockquote:text-slate-200 dark:prose-strong:text-slate-100 dark:prose-pre:bg-zinc-900 dark:prose-pre:shadow-md dark:prose-pre:border-gray-600 dark:prose-pre:border-[1.4px] dark:prose-a:text-slate-200 prose prose-xl flex flex-col mx-auto max-w-6xl justify-center pl-6 pr-6 prose-p:m-3 prose-headings:mb-3 prose-headings:mt-3 prose-a:font-bold prose-img:rounded-lg prose-img:m-auto prose-img:w-full prose-img:shadow-lg prose-code:font-jetbrains prose-pre:p-0 prose-a:no-underline prose-h1:text-4xl prose-h1:pl-2 prose-h2:pl-2 prose-blockquote:border-slate-600 prose-h2:text-xl"><div class="flex flex-col"><p class="text-4xl font-bold">Using Trait objects in Rust</p><div class="pt-3 flex justify-between flex-row-reverse"><div class="flex items-center space-x-2"><p class="text-sm">21st February 2016</p></div><div class="flex items-center space-x-2"><p class="text-sm tracking-wide">creativcoder<!-- --> / <!-- -->3min<!-- --></p></div></div><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div></div><p>This post aims to provide a very gentle introduction to traits objects in rust aimed at people who already are familiar with Traits in Rust. If you don&#x27;t know about traits well, a good read is <!-- --><a href="http://blog.rust-lang.org/2015/05/11/traits.html">here</a>. In brief, a trait is the specification of an interface. That interface can contain functions (both member, and non-member), types and constants. In Rust world, most of the constructs we use like operators, functions, loops are modelled as traits. Traits also serve the purpose of marking entities as being thread safe (the Send and Sync) or not safe. As an analogy to other programming language, traits are similar to typeclasses in haskell.<!-- --></p>
<!-- --><p>We get a trait object when things are referenced not by their actual type but by the trait that
they are implementing. Trait objects in Rust are denoted by an <!-- --><code>&amp;</code> before their name. So when can we use a trait object? A possible use case is shown here. We will build our understanding by taking a real world example. Understanding this way eventually leads us to the insight of applying it into our day today rust code.<!-- --></p>
<!-- --><p>Let&#x27;s say we want to create a musician object who is very versatile and our goal is to give him the ability, or more technically a <!-- --><code>method</code>  by which he can play any instrument given to him.
Let&#x27;s create the type:<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">struct</span> <!-- --><span class="hljs-title class_">Musician</span> {
    name:<!-- --><span class="hljs-type">String</span>
}
<!-- --></code></pre>
<!-- --><p>We&#x27;ll then create a constructor for our <!-- --><code>Musician</code> so that it&#x27;s easy to create a new Musician instance.<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Musician</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">new</span>(name: &amp;<!-- --><span class="hljs-type">str</span>) <!-- --><span class="hljs-punctuation">-&gt;</span> <!-- --><span class="hljs-keyword">Self</span> {
        Musician { name: name.<!-- --><span class="hljs-title function_ invoke__">to_string</span>() }
    }
}
<!-- --></code></pre>
<!-- --><p>Let&#x27;s also create some instruments for the musician to play.</p>
<!-- --><p>A Piano.</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">struct</span> <!-- --><span class="hljs-title class_">Piano</span> {
    keys:<!-- --><span class="hljs-type">usize</span>
}

<!-- --><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Piano</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">new</span>(key:<!-- --><span class="hljs-type">usize</span>) <!-- --><span class="hljs-punctuation">-&gt;</span> <!-- --><span class="hljs-keyword">Self</span> {
        Piano { keys: key }
    }
}
<!-- --></code></pre>
<!-- --><p>and a Guitar.</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">enum</span> <!-- --><span class="hljs-title class_">GuitarType</span> {
    Acoustic,
    Electric
}

<!-- --><span class="hljs-keyword">use</span> GuitarType::*;

<!-- --><span class="hljs-keyword">struct</span> <!-- --><span class="hljs-title class_">Guitar</span> {
    _<!-- --><span class="hljs-keyword">type</span>:GuitarType
}

<!-- --><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Guitar</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">new</span>(_typ:GuitarType) <!-- --><span class="hljs-punctuation">-&gt;</span> <!-- --><span class="hljs-keyword">Self</span> {
        Guitar { _<!-- --><span class="hljs-keyword">type</span>: _typ }
    }
}
<!-- --></code></pre>
<!-- --><p>Now let&#x27;s define a trait called <!-- --><code>Playable</code>, that has a method called <!-- --><code>play</code>.<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">trait</span> <!-- --><span class="hljs-title class_">Playable</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">play</span>(&amp;<!-- --><span class="hljs-keyword">self</span>);
}
<!-- --></code></pre>
<!-- --><p>We&#x27;ll impl the <!-- --><code>Playable</code> trait for both of our instruments:<!-- --></p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Playable</span> <!-- --><span class="hljs-keyword">for</span> <!-- --><span class="hljs-title class_">Guitar</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">play</span>(&amp;<!-- --><span class="hljs-keyword">self</span>) {
        <!-- --><span class="hljs-built_in">println!</span>(<!-- --><span class="hljs-string">&quot;playing guitar&quot;</span>);
    }
}

<!-- --><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Playable</span> <!-- --><span class="hljs-keyword">for</span> <!-- --><span class="hljs-title class_">Piano</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">play</span>(&amp;<!-- --><span class="hljs-keyword">self</span>) {
        <!-- --><span class="hljs-built_in">println!</span>(<!-- --><span class="hljs-string">&quot;playing piano&quot;</span>);
    }
}
<!-- --></code></pre>
<!-- --><p>Now comes the interesting part. Look closely.</p>
<!-- --><pre><code class="hljs language-rust"><span class="hljs-keyword">impl</span> <!-- --><span class="hljs-title class_">Musician</span> {
    <!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">play_instrument</span>(&amp;<!-- --><span class="hljs-keyword">self</span>, ins:&amp;Playable) {
        ins.<!-- --><span class="hljs-title function_ invoke__">play</span>();
    }
}


<!-- --><span class="hljs-keyword">fn</span> <!-- --><span class="hljs-title function_">main</span>() {
    <!-- --><span class="hljs-keyword">let</span> <!-- --><span class="hljs-keyword"></span><span class="hljs-variable">musician</span> = Musician::<!-- --><span class="hljs-title function_ invoke__">new</span>(<!-- --><span class="hljs-string">&quot;Sam&quot;</span>);
    musician.<!-- --><span class="hljs-title function_ invoke__">play_instrument</span>(&amp;Piano::<!-- --><span class="hljs-title function_ invoke__">new</span>(<!-- --><span class="hljs-number">34</span>));
    musician.<!-- --><span class="hljs-title function_ invoke__">play_instrument</span>(&amp;Guitar::<!-- --><span class="hljs-title function_ invoke__">new</span>(Acoustic));
}
<!-- --></code></pre>
<!-- --><p>In the code above, we are defining a generic method <!-- --><code>play_instrument</code> on our <!-- --><code>Musician</code> struct that can take any type (<!-- --><code>&amp;Playable</code>) that implements the Playable trait. We have used a trait object here.<!-- --></p>
<!-- --><p>The <!-- --><code>play_instrument</code> method will take any type implementing the <!-- --><code>Playable</code> trait as a argument for <!-- --><code>ins</code> parameter, which in our case are <!-- --><code>Guitar</code> and <!-- --><code>Piano</code>.<!-- --></p>
<!-- --><p>Using trait objects, we have made our <!-- --><code>Musician</code>, play any instrument. In this way it play a guitar as well as a piano.<!-- --></p>
<!-- --><p>Trait objects mimics a sort of dynamic dispatch or runtime polymorphism.
It uses virtual method table internally, for resolving the appropriate method to call.
During invocation of the <!-- --><code>play_instrument</code> at runtime, Rust uses two pointers: one for the value with which the method was invoked and other which points to a table of methods for the given trait impls. After resolving the correct method using pointer arithmetic, it passes the value pointer to that specific method. This all happens at runtime. This means that trait objects have a runtime overhead as compared to static dispatch using only traits.<!-- --></p>
<!-- --><p>Hope that was helpful. Have a great day!</p><div class="flex justify-center"><hr class="mb-8 h-px bg-gray-400 border-0 dark:bg-gray-500 w-full"/></div><p class="text-sm font-bold">Want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please follow Rust&#x27;s code of conduct. This comment thread directly maps to a discussion on GitHub, so you can also comment there if you prefer.</p></article>;<!-- --></div><footer class="flex flex-col items-center w-full"><div class="px-4 py-2 flex items-center justify-center space-x-2 border-2 rounded-md border-gray-500 hover:bg-blue-100 transition-colors hover:text-lime-900"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"></path></svg><p>Be a GitHub Sponser</p></div><div class="flex-col items-center justify-center mt-8 mb-8"><div class="text-center text-xs mx-auto">© 2016-<!-- -->2022<!-- --> creativcoder. All rights reserved.<!-- --></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    code: \"code\",\n    pre: \"pre\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"This post aims to provide a very gentle introduction to traits objects in rust aimed at people who already are familiar with Traits in Rust. If you don't know about traits well, a good read is \", _jsx(_components.a, {\n        href: \"http://blog.rust-lang.org/2015/05/11/traits.html\",\n        children: \"here\"\n      }), \". In brief, a trait is the specification of an interface. That interface can contain functions (both member, and non-member), types and constants. In Rust world, most of the constructs we use like operators, functions, loops are modelled as traits. Traits also serve the purpose of marking entities as being thread safe (the Send and Sync) or not safe. As an analogy to other programming language, traits are similar to typeclasses in haskell.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We get a trait object when things are referenced not by their actual type but by the trait that\\nthey are implementing. Trait objects in Rust are denoted by an \", _jsx(_components.code, {\n        children: \"\u0026\"\n      }), \" before their name. So when can we use a trait object? A possible use case is shown here. We will build our understanding by taking a real world example. Understanding this way eventually leads us to the insight of applying it into our day today rust code.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let's say we want to create a musician object who is very versatile and our goal is to give him the ability, or more technically a \", _jsx(_components.code, {\n        children: \"method\"\n      }), \"  by which he can play any instrument given to him.\\nLet's create the type:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"struct\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Musician\"\n        }), \" {\\n    name:\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"String\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We'll then create a constructor for our \", _jsx(_components.code, {\n        children: \"Musician\"\n      }), \" so that it's easy to create a new Musician instance.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Musician\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"new\"\n        }), \"(name: \u0026\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"str\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"Self\"\n        }), \" {\\n        Musician { name: name.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"to_string\"\n        }), \"() }\\n    }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's also create some instruments for the musician to play.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A Piano.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"struct\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Piano\"\n        }), \" {\\n    keys:\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"usize\"\n        }), \"\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Piano\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"new\"\n        }), \"(key:\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"usize\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"Self\"\n        }), \" {\\n        Piano { keys: key }\\n    }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"and a Guitar.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"enum\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"GuitarType\"\n        }), \" {\\n    Acoustic,\\n    Electric\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"use\"\n        }), \" GuitarType::*;\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"struct\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Guitar\"\n        }), \" {\\n    _\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"type\"\n        }), \":GuitarType\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Guitar\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"new\"\n        }), \"(_typ:GuitarType) \", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"-\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"Self\"\n        }), \" {\\n        Guitar { _\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"type\"\n        }), \": _typ }\\n    }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now let's define a trait called \", _jsx(_components.code, {\n        children: \"Playable\"\n      }), \", that has a method called \", _jsx(_components.code, {\n        children: \"play\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"trait\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Playable\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"play\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"self\"\n        }), \");\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We'll impl the \", _jsx(_components.code, {\n        children: \"Playable\"\n      }), \" trait for both of our instruments:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Playable\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Guitar\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"play\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"self\"\n        }), \") {\\n        \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"println!\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"playing guitar\\\"\"\n        }), \");\\n    }\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Playable\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Piano\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"play\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"self\"\n        }), \") {\\n        \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"println!\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"playing piano\\\"\"\n        }), \");\\n    }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now comes the interesting part. Look closely.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"impl\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Musician\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"play_instrument\"\n        }), \"(\u0026\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"self\"\n        }), \", ins:\u0026Playable) {\\n        ins.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"play\"\n        }), \"();\\n    }\\n}\\n\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), \"() {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"let\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\"\n        }), _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"musician\"\n        }), \" = Musician::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"new\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Sam\\\"\"\n        }), \");\\n    musician.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"play_instrument\"\n        }), \"(\u0026Piano::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"new\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"34\"\n        }), \"));\\n    musician.\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"play_instrument\"\n        }), \"(\u0026Guitar::\", _jsx(_components.span, {\n          className: \"hljs-title function_ invoke__\",\n          children: \"new\"\n        }), \"(Acoustic));\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the code above, we are defining a generic method \", _jsx(_components.code, {\n        children: \"play_instrument\"\n      }), \" on our \", _jsx(_components.code, {\n        children: \"Musician\"\n      }), \" struct that can take any type (\", _jsx(_components.code, {\n        children: \"\u0026Playable\"\n      }), \") that implements the Playable trait. We have used a trait object here.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"play_instrument\"\n      }), \" method will take any type implementing the \", _jsx(_components.code, {\n        children: \"Playable\"\n      }), \" trait as a argument for \", _jsx(_components.code, {\n        children: \"ins\"\n      }), \" parameter, which in our case are \", _jsx(_components.code, {\n        children: \"Guitar\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"Piano\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Using trait objects, we have made our \", _jsx(_components.code, {\n        children: \"Musician\"\n      }), \", play any instrument. In this way it play a guitar as well as a piano.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Trait objects mimics a sort of dynamic dispatch or runtime polymorphism.\\nIt uses virtual method table internally, for resolving the appropriate method to call.\\nDuring invocation of the \", _jsx(_components.code, {\n        children: \"play_instrument\"\n      }), \" at runtime, Rust uses two pointers: one for the value with which the method was invoked and other which points to a table of methods for the given trait impls. After resolving the correct method using pointer arithmetic, it passes the value pointer to that specific method. This all happens at runtime. This means that trait objects have a runtime overhead as compared to static dispatch using only traits.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Hope that was helpful. Have a great day!\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"meta":{"excerpt":"On making your rust code polymorphic","slug":"trait-objects-rust","title":"Using Trait objects in Rust","tags":["dispatch","rust","trait objects"],"date":"Sun Feb 21 2016 05:30:00 GMT+0530 (India Standard Time)","author":"creativcoder","readingTime":"3min"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"trait-objects-rust"},"buildId":"C0oqtusQj9cY-EdwLN_RL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>